@using Abp.Web.Mvc.Extensions
@using System.Text
@using ECJ.Web.Models
@{
    ViewBag.Title = "Detail";
    @*Service, Salle, Forfait, Engagement*@

    //bug avec le model par défaut lorsqu'on utilise un tuple avec 5 éléments...
    Tuple<tblSousEvenement, List<tblService>, List<tblSalle>, List<tblForfait>, List<tblEngagement>> Model = ViewBag.listTuple;
}
<a href="~/Calculateur/@Model.Item1.noSousEvenement" data-toggle="modal" class="btn btn-primary pull-right"><i class="fa fa-calculator"></i> Ouvrir le calculateur</a>

<h2>Détail d'un sous-évènement</h2>

@section scripts
{
    @Html.IncludeScript("~/Views/SousEvenements/Detail.js")
}
<div name="createPub" role="form" novalidate class="form-validation">
    
    <div class="form-group">
        <label>Évènement</label>
        <div class="well well-sm">
            @Model.Item1.nom
        </div>
    </div>
    <div class="form-group">
        <label>Description</label>
        <div class="well well-lg">
            @Model.Item1.description
        </div>
    </div>
    <label>Services requis</label>
    <button data-target="#ServiceAjoutModal" data-toggle="modal" class="btn btn-primary pull-right"><i class="fa fa-plus"></i> Ajouter un service</button>
    <div class="form-group">
        @using (Html.BeginForm())
        {
         @Html.AntiForgeryToken()
         @Html.ValidationSummary(true)
        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th>Nom</th>
                    <th class="col-md-2">Action</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var s in Model.Item1.tblService)
                {
                    <tr>
                        <td>@s.nomService</td>
                        <td>
                            <button name="service_suppr" value="@s.noService" class="btn btn-sm btn-danger" title="Supprimer"><i class="fa fa-trash fa-lg"></i></button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
        }
    </div>
    <label>Salles</label>
    <a href="/sousEvenements/Ajout" data-toggle="modal" class="btn btn-primary pull-right"><i class="fa fa-plus"></i> Ajouter une salle</a>
    <div class="form-group">
        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th>Nom</th>
                    <th>Prix</th>
                    <th>Billets standard</th>
                    <th>Billets VIP</th>
                    <th class="col-md-2">Action</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Salle François Brassard</td>
                    <td>5000$</td>
                    <td>10$</td>
                    <td>30$</td>
                    <td>
                        <a href="" class="btn btn-sm btn-danger" title="Supprimer"><i class="fa fa-trash fa-lg"></i></a>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <label>Forfaits</label>
    <a href="/sousEvenements/Ajout" data-toggle="modal" class="btn btn-primary pull-right"><i class="fa fa-plus"></i> Ajouter un forfait</a>
    <div class="form-group">
        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th>Nom</th>
                    <th>Description</th>
                    <th class="col-md-2">Action</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var f in Model.Item1.tblForfait)
                {
                    <tr>
                        <td>@f.nom</td>
                        <td>@f.description</td>
                        <td>
                            <a href="~/Views/ForfaitSousEvenement/Delete/@f.noForfait" class="btn btn-sm btn-danger" title="Supprimer"><i class="fa fa-trash fa-lg"></i></a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <label>Engagement</label>
    <a href="/sousEvenements/Ajout" data-toggle="modal" class="btn btn-primary pull-right"><i class="fa fa-plus"></i> Ajouter un engagement</a>
    <div class="form-group">
        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th>Nom</th>
                    <th>Statut</th>
                    <th>Date</th>
                    <th>Montant</th>
                    <th>Description courte</th>
                    <th class="col-md-2">Action</th>
                </tr>
            </thead>
            <tbody>

                <tr>
                    <td>L'éclairage</td>
                    <td>En cours</td>
                    <td>14/10/2016</td>
                    <td>120.00$</td>
                    <td>Doit changer une ampoule dans la section B</td>
                    <td>
                        <a href="" class="btn btn-sm btn-danger" title="Supprimer"><i class="fa fa-trash fa-lg"></i></a>
                    </td>
                </tr>
                <tr>
                    <td>La musique</td>
                    <td>En cours</td>
                    <td>18/10/2016</td>
                    <td>40.00$</td>
                    <td>Doit mettre de nouveaux morceaux a la musique d'avant-spectacle</td>
                    <td>
                        <a href="" class="btn btn-sm btn-danger" title="Supprimer"><i class="fa fa-trash fa-lg"></i></a>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <label>Activités</label>
    <a href="/Activite/Ajout/?sousevenement_id=@Model.Item1.noEvenement" class="btn btn-primary pull-right"><i class="fa fa-plus"></i> Ajouter une activité</a>
    <ul class="nav nav-tabs">
        <li class="active"><a href="#liste" data-toggle="tab" aria-expanded="true">Liste</a></li>
        <li class=""><a href="#calendrier" data-toggle="tab" aria-expanded="false">Calendrier</a></li>
    </ul>
    <div id="myTabContent" class="tab-content">
        <div class="tab-pane active fade in" id="liste">
            <div class="form-group">
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th>Responsable</th>
                            <th>Tâche</th>
                            <th>Détails</th>
                            <th>Date</th>
                            <th class="col-md-2">Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        @{StringBuilder dates = new StringBuilder(); }
                        @foreach (var a in Model.Item1.tblActivite)
                        {
                            dates.Append("{ date: \"" + String.Format("{0:yyyy-MM-dd}", a.dateCreation) + "\" },");
                            <tr>
                                <td>@a.nomResponsable</td>
                                <td>@a.tache</td>
                                <td>@a.detail</td>
                                <td>@String.Format("{0:yyyy/MM/dd}", a.dateCreation)</td>
                                <td>
                                    <a href="/Activite/Detail/@a.noActivite" class="btn btn-sm btn-primary" title="Détail"><i class="fa fa-info-circle fa-lg"></i></a>
                                    <a href="/Activite/Edit/@a.noActivite" class="btn btn-sm btn-primary" title="Modifier"><i class="fa fa-pencil fa-lg"></i></a>
                                    <a href="/Activite/Delete/@a.noActivite" class="btn btn-sm btn-danger" title="Supprimer"><i class="fa fa-trash fa-lg"></i></a>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
        <div class="tab-pane fade in clearfix" id="calendrier">
            <div id="calendrier-inner" class="col-md-4 col-md-offset-4">

            </div>
        </div>
    </div>
</div>
@{
    if (dates.Length > 0)
    {
        <script>var dates_calendrier = @(new HtmlString("[" + dates.ToString().Substring(0, dates.ToString().Length - 1) + "]"));</script>
    }
    else
    {
        <script>var dates_calendrier = [];</script>
    }
}
@*Modal pour le choix d'un service*@
<div class="modal fade" id="ServiceAjoutModal" tabindex="-1" role="dialog" aria-labelledby="ServiceAjoutModalLabel" data-backdrop="static">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            @using (Html.BeginForm())
            {
                @Html.AntiForgeryToken()
                @Html.ValidationSummary(true)
                <div class="modal-header">
                    <h4 class="modal-title">
                        <span>Choisir un service</span>
                    </h4>
                </div>
                <div class="modal-body">

                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>Nom du service</th>
                                <th>Sélection</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var s in Model.Item2)
                            {
                                <tr>
                                    <td>@s.nomService</td>
                                    <td><button name="service" value="@s.noService" class="btn btn-primary btn-sm"><i class="fa fa-check-square"></i></button></td>
                                </tr>
                                }
                        </tbody>
                    </table>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Annuler</button>
                </div>
            }
        </div>
    </div>
</div>